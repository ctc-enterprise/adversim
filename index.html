<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physical Adversarial Attacks: Research Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; color: #1F2937; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
        canvas { touch-action: none; }
    </style>
    <!-- Chosen Palette: "Secure Neutral" - Warm gray background, distinct Slate/Blue for UI, Red/Amber/Emerald for Status/Attacks -->
    <!-- Application Structure Plan:
         1. Hero: Title and definitions.
         2. Methodology: Interactive EOT visualizer (Canvas).
         3. Attack Lab: Main simulator (Canvas) allowing user to toggle attack types.
         4. Data Analysis: Charts showing ASR statistics.
         5. Implications: Summary text.
    -->
    <!-- Visualization & Content Choices:
         - EOT Visualizer: Custom Canvas animation to show rotation/scale (Goal: Explain Methodology).
         - Attack Lab: Custom Canvas to draw image + boxes. Interactive toggles simulate the attacks described in README (Vanishing/Miscat/Fab).
         - Charts: Bar/Line charts for Attack Success Rates (Goal: Quantify Impact).
         - Justification: Canvas provides high-performance rendering for the "simulation" aspect without external dependencies like SVG/Mermaid.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-gray-50 text-slate-800">

    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <span class="font-bold text-xl tracking-tight text-slate-900">üõ°Ô∏è AdverSim: Physical Attacks</span>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#overview" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Overview</a>
                        <a href="#methodology" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Methodology (EOT)</a>
                        <a href="#simulation" class="border-indigo-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Attack Simulation</a>
                        <a href="#analysis" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Data Analysis</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- 1. Executive Summary -->
        <section id="overview" class="bg-white rounded-xl shadow-sm p-8 border border-gray-100">
            <div class="max-w-3xl">
                <h1 class="text-3xl font-extrabold text-slate-900 mb-4">Physical Adversarial Examples in Object Detection</h1>
                <p class="text-lg text-gray-600 mb-6">
                    Unlike digital attacks that manipulate pixels imperceptibly, <strong>Physical Adversarial Attacks</strong> introduce tangible artifacts‚Äîstickers, patches, or posters‚Äîinto the real world. These "Adversarial Patches" are robust to viewing angles and lighting, capable of blinding state-of-the-art AI detectors like YOLO and Faster R-CNN.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                    <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                        <h3 class="font-bold text-red-700">Object Vanishing</h3>
                        <p class="text-sm text-red-600 mt-1">"The Invisibility Cloak"</p>
                        <p class="text-sm text-gray-600 mt-2">Making valid objects (people, stop signs) completely undetectable.</p>
                    </div>
                    <div class="p-4 bg-amber-50 rounded-lg border-l-4 border-amber-500">
                        <h3 class="font-bold text-amber-700">Miscategorization</h3>
                        <p class="text-sm text-amber-600 mt-1">"The Decoy"</p>
                        <p class="text-sm text-gray-600 mt-2">Flipping labels, e.g., making a Stop sign appear as a Speed Limit sign.</p>
                    </div>
                    <div class="p-4 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                        <h3 class="font-bold text-indigo-700">Fabrication</h3>
                        <p class="text-sm text-indigo-600 mt-1">"The Phantom"</p>
                        <p class="text-sm text-gray-600 mt-2">Causing the model to hallucinate non-existent objects in empty space.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Methodology: EOT Interactive -->
        <section id="methodology">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                <div>
                    <h2 class="text-2xl font-bold text-slate-900 mb-4">The Key to Physical Attacks: Expectation Over Transformation (EOT)</h2>
                    <p class="text-gray-600 mb-4">
                        A static digital patch fails in the real world because the camera moves. <strong>EOT</strong> solves this by optimizing the patch across a distribution of transformations.
                    </p>
                    <ul class="space-y-3 text-gray-600 list-disc pl-5 mb-6">
                        <li><strong>Affine Transforms:</strong> The patch is rotated, scaled, and sheared during training.</li>
                        <li><strong>Color Jitter:</strong> Brightness and contrast are randomized to simulate lighting changes.</li>
                        <li><strong>Result:</strong> A "robust" patch that works from many angles.</li>
                    </ul>
                    <div class="bg-blue-50 p-4 rounded-lg text-sm text-blue-800">
                        <strong>Interactive Demo:</strong> Observe how the patch (right) constantly mutates. In EOT, the AI trains against <em>all</em> these variations simultaneously.
                    </div>
                </div>

                <!-- EOT Canvas Container -->
                <div class="bg-slate-900 rounded-xl p-4 shadow-lg flex flex-col items-center justify-center">
                    <div class="text-gray-400 text-xs uppercase tracking-wider mb-2">EOT Transformation Stream</div>
                    <div class="relative w-full max-w-sm aspect-video bg-gray-800 rounded overflow-hidden">
                        <canvas id="eotCanvas" class="w-full h-full"></canvas>
                    </div>
                    <div class="mt-3 flex justify-between w-full max-w-sm text-xs text-gray-500">
                        <span>Rotation: <span id="eotRot">0</span>¬∞</span>
                        <span>Scale: <span id="eotScale">1.0</span>x</span>
                        <span>Brightness: <span id="eotBright">100</span>%</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Attack Simulation Lab -->
        <section id="simulation" class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="bg-slate-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold text-slate-900">Physical Attack Simulation Lab</h2>
                    <p class="text-sm text-gray-500">Configure parameters to attack the Object Detector.</p>
                </div>
                <div class="flex space-x-2">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        Model: Faster R-CNN (ResNet50)
                    </span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        Input: RGB Camera
                    </span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 min-h-[600px]">
                <!-- Controls Sidebar -->
                <div class="lg:col-span-4 bg-gray-50 p-6 border-r border-gray-200 flex flex-col gap-8">

                    <!-- Attack Selector -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Attack Vector</label>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-white transition-colors bg-white shadow-sm border-gray-200 ring-2 ring-transparent has-[:checked]:ring-indigo-500">
                                <input type="radio" name="attackType" value="none" class="h-4 w-4 text-indigo-600" checked onchange="updateSimulation()">
                                <div class="ml-3">
                                    <span class="block text-sm font-medium text-gray-900">No Attack (Baseline)</span>
                                    <span class="block text-xs text-gray-500">Standard detection performance</span>
                                </div>
                            </label>

                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-white transition-colors bg-white shadow-sm border-gray-200 ring-2 ring-transparent has-[:checked]:ring-red-500">
                                <input type="radio" name="attackType" value="vanishing" class="h-4 w-4 text-red-600" onchange="updateSimulation()">
                                <div class="ml-3">
                                    <span class="block text-sm font-medium text-gray-900">Object Vanishing</span>
                                    <span class="block text-xs text-gray-500">Target: Person (Class suppression)</span>
                                </div>
                            </label>

                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-white transition-colors bg-white shadow-sm border-gray-200 ring-2 ring-transparent has-[:checked]:ring-amber-500">
                                <input type="radio" name="attackType" value="miscat" class="h-4 w-4 text-amber-600" onchange="updateSimulation()">
                                <div class="ml-3">
                                    <span class="block text-sm font-medium text-gray-900">Miscategorization</span>
                                    <span class="block text-xs text-gray-500">Target: Stop Sign &rarr; Speed Limit</span>
                                </div>
                            </label>

                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-white transition-colors bg-white shadow-sm border-gray-200 ring-2 ring-transparent has-[:checked]:ring-purple-500">
                                <input type="radio" name="attackType" value="fabrication" class="h-4 w-4 text-purple-600" onchange="updateSimulation()">
                                <div class="ml-3">
                                    <span class="block text-sm font-medium text-gray-900">Object Fabrication</span>
                                    <span class="block text-xs text-gray-500">Target: Phantom Car</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Details Box -->
                    <div id="attackDetails" class="bg-white p-4 rounded-lg border border-gray-200 text-sm">
                        <h4 class="font-semibold text-gray-900 mb-2">System Status</h4>
                        <p id="statusText" class="text-gray-600">System running normally. All objects detected with high confidence.</p>
                        <div class="mt-4 pt-4 border-t border-gray-100 grid grid-cols-2 gap-2 text-xs">
                            <div>
                                <span class="text-gray-400">Confidence Threshold</span>
                                <div class="font-mono">0.50</div>
                            </div>
                            <div>
                                <span class="text-gray-400">Patch Opacity</span>
                                <div class="font-mono">100%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Simulation Viewport -->
                <div class="lg:col-span-8 bg-gray-900 relative flex items-center justify-center p-4">
                    <div class="relative w-full max-w-2xl bg-black rounded-lg overflow-hidden shadow-2xl border border-gray-800">
                        <!-- Header Overlay -->
                        <div class="absolute top-0 left-0 right-0 bg-black/50 backdrop-blur-sm p-2 flex justify-between items-center z-10 text-xs text-green-400 font-mono">
                            <span>LIVE FEED - CAM_01</span>
                            <span id="fpsCounter">30 FPS</span>
                        </div>

                        <!-- Main Canvas -->
                        <canvas id="simCanvas" class="w-full h-auto block" width="800" height="500"></canvas>

                        <!-- Legend -->
                        <div class="absolute bottom-4 left-4 flex gap-3 z-10">
                            <div class="flex items-center bg-black/70 px-2 py-1 rounded text-xs text-white">
                                <span class="w-2 h-2 rounded-full bg-green-500 mr-2"></span> Person
                            </div>
                            <div class="flex items-center bg-black/70 px-2 py-1 rounded text-xs text-white">
                                <span class="w-2 h-2 rounded-full bg-blue-500 mr-2"></span> Vehicle
                            </div>
                            <div class="flex items-center bg-black/70 px-2 py-1 rounded text-xs text-white">
                                <span class="w-2 h-2 rounded-full bg-red-500 mr-2"></span> Traffic Sign
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Data Analysis -->
        <section id="analysis" class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-gray-900">Attack Success Rate (ASR) vs. Viewing Angle</h3>
                    <p class="text-sm text-gray-500">Physical patches degrade as viewing angle increases. EOT optimization (orange) significantly improves robustness compared to standard patches (blue).</p>
                </div>
                <div class="chart-container">
                    <canvas id="angleChart"></canvas>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-gray-900">Vulnerability by Object Class</h3>
                    <p class="text-sm text-gray-500">Susceptibility of different classes to physical patch attacks (based on Eykholt et al. & Wei et al.).</p>
                </div>
                <div class="chart-container">
                    <canvas id="classChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="border-t border-gray-200 pt-8 pb-12">
            <div class="text-center text-gray-500 text-sm">
                <p class="mb-2">&copy; 2025 Physical Adversarial Research Demo.</p>
                <p>Based on research by Eykholt et al. (WOOT '18), Wei et al. (CVPR '23), and Thys et al. (CVPRW '19).</p>
            </div>
        </footer>

    </main>

    <script>
        // --- 1. EOT Visualizer Logic ---
        const eotCtx = document.getElementById('eotCanvas').getContext('2d');
        let eotTime = 0;

        function drawEOT() {
            const w = eotCtx.canvas.width = 400;
            const h = eotCtx.canvas.height = 225;
            eotTime += 0.02;

            // Clear
            eotCtx.fillStyle = '#111827';
            eotCtx.fillRect(0, 0, w, h);

            // Calculate Transforms
            const scale = 1 + Math.sin(eotTime) * 0.3; // 0.7 to 1.3
            const rotation = Math.cos(eotTime * 0.5) * 0.5; // Radians
            const brightness = 100 + Math.sin(eotTime * 2) * 40; // 60% to 140%

            // Update UI Labels
            document.getElementById('eotScale').innerText = scale.toFixed(2);
            document.getElementById('eotRot').innerText = (rotation * (180/Math.PI)).toFixed(0);
            document.getElementById('eotBright').innerText = brightness.toFixed(0);

            // Draw "Image" Background (Grid)
            eotCtx.strokeStyle = '#374151';
            eotCtx.lineWidth = 1;
            for(let i=0; i<w; i+=40) { eotCtx.beginPath(); eotCtx.moveTo(i,0); eotCtx.lineTo(i,h); eotCtx.stroke(); }
            for(let i=0; i<h; i+=40) { eotCtx.beginPath(); eotCtx.moveTo(0,i); eotCtx.lineTo(w,i); eotCtx.stroke(); }

            // Draw Patch
            eotCtx.save();
            eotCtx.translate(w/2, h/2);
            eotCtx.rotate(rotation);
            eotCtx.scale(scale, scale);

            // Patch Content (Psychedelic Pattern common in adversarial patches)
            const patchSize = 80;
            eotCtx.fillStyle = `hsl(${eotTime * 50}, 70%, ${brightness/2}%)`;
            eotCtx.fillRect(-patchSize/2, -patchSize/2, patchSize, patchSize);

            // Inner Noise
            for(let i=0; i<5; i++) {
                eotCtx.fillStyle = `hsl(${(eotTime * 50 + i*40)}, 80%, 50%)`;
                eotCtx.beginPath();
                eotCtx.arc(
                    Math.sin(i + eotTime)*20,
                    Math.cos(i + eotTime)*20,
                    10, 0, Math.PI*2
                );
                eotCtx.fill();
            }

            eotCtx.restore();

            // Text Overlay
            eotCtx.fillStyle = '#ffffff';
            eotCtx.font = '12px Inter';
            eotCtx.fillText("Optimizing for Robustness...", 10, h-10);

            requestAnimationFrame(drawEOT);
        }
        drawEOT();

        // --- 2. Attack Simulation Logic ---
        const simCanvas = document.getElementById('simCanvas');
        const simCtx = simCanvas.getContext('2d');
        let currentAttack = 'none'; // none, vanishing, miscat, fabrication

        // Simulation State Data
        const objects = {
            person: { x: 150, y: 180, w: 100, h: 220, label: 'Person', conf: 0.98, color: '#22c55e', type: 'person' },
            sign: { x: 550, y: 100, w: 80, h: 80, label: 'Stop Sign', conf: 0.99, color: '#ef4444', type: 'sign' },
            car: { x: 350, y: 250, w: 200, h: 120, label: 'Car', conf: 0.95, color: '#3b82f6', type: 'car' }
        };

        const phantomObject = { x: 50, y: 300, w: 120, h: 100, label: 'Car', conf: 0.88, color: '#3b82f6', type: 'fabrication' };

        function updateSimulation() {
            const radios = document.getElementsByName('attackType');
            for(let r of radios) { if(r.checked) currentAttack = r.value; }

            // Update Text Description
            const statusEl = document.getElementById('statusText');
            if(currentAttack === 'none') statusEl.innerHTML = "System running normally. Baseline detection of <span class='text-green-600 font-bold'>Person</span>, <span class='text-blue-600 font-bold'>Car</span>, and <span class='text-red-600 font-bold'>Stop Sign</span>.";
            else if(currentAttack === 'vanishing') statusEl.innerHTML = "<span class='text-red-600 font-bold'>ATTACK ACTIVE:</span> Adversarial patch applied to Person. Confidence dropped below threshold. Object suppressed.";
            else if(currentAttack === 'miscat') statusEl.innerHTML = "<span class='text-amber-600 font-bold'>ATTACK ACTIVE:</span> Adversarial sticker applied to Stop Sign. Features perturbed to match 'Speed Limit 50'.";
            else if(currentAttack === 'fabrication') statusEl.innerHTML = "<span class='text-purple-600 font-bold'>ATTACK ACTIVE:</span> Pattern placed on empty road. Model hallucinates a 'Car' where none exists.";

            drawSimulationFrame();
        }

        function drawSimulationFrame() {
            const w = simCanvas.width;
            const h = simCanvas.height;

            // 1. Draw Background (Simulated Street Scene)
            // Sky
            const grd = simCtx.createLinearGradient(0, 0, 0, h);
            grd.addColorStop(0, "#87CEEB");
            grd.addColorStop(0.5, "#E0F7FA");
            grd.addColorStop(0.5, "#374151"); // Horizon line
            grd.addColorStop(1, "#1F2937"); // Road
            simCtx.fillStyle = grd;
            simCtx.fillRect(0, 0, w, h);

            // Road markings
            simCtx.strokeStyle = "#FCD34D";
            simCtx.setLineDash([20, 20]);
            simCtx.lineWidth = 4;
            simCtx.beginPath();
            simCtx.moveTo(w/2 - 100, h/2);
            simCtx.lineTo(w/2 - 300, h);
            simCtx.stroke();
            simCtx.beginPath();
            simCtx.moveTo(w/2 + 100, h/2);
            simCtx.lineTo(w/2 + 300, h);
            simCtx.stroke();
            simCtx.setLineDash([]);

            // 2. Draw Objects
            // Helper to draw an object
            const drawObj = (obj, labelOverride = null, hideBox = false, showPatch = false) => {
                // Shadow
                simCtx.fillStyle = 'rgba(0,0,0,0.3)';
                simCtx.beginPath();
                simCtx.ellipse(obj.x + obj.w/2, obj.y + obj.h, obj.w/2, 10, 0, 0, Math.PI*2);
                simCtx.fill();

                // Simple Shape Representation
                simCtx.fillStyle = (obj.type === 'person') ? '#D1D5DB' : (obj.type === 'sign' ? '#991B1B' : '#4B5563');
                if (obj.type === 'sign') {
                    // Stop sign pole
                    simCtx.fillStyle = '#6B7280';
                    simCtx.fillRect(obj.x + obj.w/2 - 5, obj.y + obj.h, 10, 100);
                    // Hexagon
                    simCtx.fillStyle = '#DC2626';
                    simCtx.beginPath();
                    simCtx.moveTo(obj.x + obj.w*0.3, obj.y);
                    simCtx.lineTo(obj.x + obj.w*0.7, obj.y);
                    simCtx.lineTo(obj.x + obj.w, obj.y + obj.h*0.5);
                    simCtx.lineTo(obj.x + obj.w*0.7, obj.y + obj.h);
                    simCtx.lineTo(obj.x + obj.w*0.3, obj.y + obj.h);
                    simCtx.lineTo(obj.x, obj.y + obj.h*0.5);
                    simCtx.closePath();
                    simCtx.fill();
                    simCtx.fillStyle = 'white';
                    simCtx.font = 'bold 16px sans-serif';
                    simCtx.fillText("STOP", obj.x + 18, obj.y + 45);
                } else if (obj.type === 'person') {
                    // Person blob
                    simCtx.fillStyle = '#4B5563'; // pants
                    simCtx.fillRect(obj.x + 20, obj.y + 120, 25, 100);
                    simCtx.fillRect(obj.x + 55, obj.y + 120, 25, 100);
                    simCtx.fillStyle = '#60A5FA'; // shirt
                    simCtx.fillRect(obj.x + 10, obj.y + 40, 80, 80);
                    simCtx.fillStyle = '#FCA5A5'; // head
                    simCtx.beginPath();
                    simCtx.arc(obj.x + 50, obj.y + 20, 20, 0, Math.PI*2);
                    simCtx.fill();
                } else if (obj.type === 'car' || obj.type === 'fabrication') {
                    // Car blob
                    simCtx.fillStyle = '#1E40AF';
                    simCtx.fillRect(obj.x, obj.y + 40, obj.w, obj.h - 40);
                    simCtx.fillStyle = '#93C5FD'; // window
                    simCtx.fillRect(obj.x + 20, obj.y, obj.w - 40, 40);
                    // Wheels
                    simCtx.fillStyle = 'black';
                    simCtx.beginPath(); simCtx.arc(obj.x + 40, obj.y + obj.h, 20, 0, Math.PI*2); simCtx.fill();
                    simCtx.beginPath(); simCtx.arc(obj.x + obj.w - 40, obj.y + obj.h, 20, 0, Math.PI*2); simCtx.fill();
                }

                // Draw Adversarial Patch if needed
                if (showPatch) {
                    simCtx.save();
                    simCtx.translate(obj.x + obj.w/2, obj.y + obj.h/2);
                    simCtx.rotate(0.1); // Slight tilt
                    // Patch visuals
                    const pw = 40, ph = 40;
                    simCtx.fillStyle = '#F59E0B'; // Gold/Noise color
                    simCtx.fillRect(-pw/2, -ph/2, pw, ph);
                    // Add noise texture
                    for(let i=0; i<50; i++) {
                        simCtx.fillStyle = Math.random() > 0.5 ? '#000' : '#FFF';
                        simCtx.fillRect(-pw/2 + Math.random()*pw, -ph/2 + Math.random()*ph, 4, 4);
                    }
                    simCtx.restore();
                }

                // Draw Bounding Box & Label
                if (!hideBox) {
                    const label = labelOverride || obj.label;
                    const conf = labelOverride ? (Math.random() * 0.1 + 0.85).toFixed(2) : obj.conf;
                    const color = (label.includes("Sign") || label.includes("Speed")) ? '#ef4444' : (label === 'Person' ? '#22c55e' : '#3b82f6');

                    simCtx.strokeStyle = color;
                    simCtx.lineWidth = 3;
                    simCtx.strokeRect(obj.x, obj.y, obj.w, obj.h);

                    // Label Background
                    const textWidth = simCtx.measureText(`${label} ${conf}`).width;
                    simCtx.fillStyle = color;
                    simCtx.fillRect(obj.x, obj.y - 25, textWidth + 20, 25);

                    // Text
                    simCtx.fillStyle = 'white';
                    simCtx.font = 'bold 14px Inter';
                    simCtx.fillText(`${label} ${conf}`, obj.x + 5, obj.y - 8);
                }
            };

            // Logic Tree
            if (currentAttack === 'none') {
                drawObj(objects.car);
                drawObj(objects.sign);
                drawObj(objects.person);
            } else if (currentAttack === 'vanishing') {
                drawObj(objects.car);
                drawObj(objects.sign);
                // Person has patch and NO box
                drawObj(objects.person, null, true, true);
            } else if (currentAttack === 'miscat') {
                drawObj(objects.car);
                // Sign has patch and WRONG label
                drawObj(objects.sign, 'Speed Limit 50', false, true);
                drawObj(objects.person);
            } else if (currentAttack === 'fabrication') {
                drawObj(objects.car);
                drawObj(objects.sign);
                drawObj(objects.person);
                // Draw patch on ground -> detected as Car
                drawObj(phantomObject, 'Car', false, true);
            }
        }

        // Init
        updateSimulation();

        // --- 3. Charts Logic ---

        // Chart 1: ASR vs Angle
        const ctxAngle = document.getElementById('angleChart').getContext('2d');
        new Chart(ctxAngle, {
            type: 'line',
            data: {
                labels: ['0¬∞ (Front)', '15¬∞', '30¬∞', '45¬∞', '60¬∞'],
                datasets: [{
                    label: 'Standard Patch',
                    data: [95, 60, 25, 10, 5],
                    borderColor: '#94a3b8',
                    backgroundColor: 'rgba(148, 163, 184, 0.2)',
                    tension: 0.4
                }, {
                    label: 'EOT-Optimized Patch',
                    data: [98, 95, 88, 75, 55],
                    borderColor: '#f97316', // Orange
                    backgroundColor: 'rgba(249, 115, 22, 0.2)',
                    borderWidth: 3,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: { display: true, text: 'Attack Success Rate (%)' }
                    }
                }
            }
        });

        // Chart 2: Vulnerability by Class
        const ctxClass = document.getElementById('classChart').getContext('2d');
        new Chart(ctxClass, {
            type: 'bar',
            data: {
                labels: ['Stop Sign', 'Person', 'Car', 'Bench', 'Fire Hydrant'],
                datasets: [{
                    label: 'Average ASR (Physical)',
                    data: [85, 80, 72, 40, 25],
                    backgroundColor: [
                        'rgba(239, 68, 68, 0.8)', // Red
                        'rgba(34, 197, 94, 0.8)', // Green
                        'rgba(59, 130, 246, 0.8)', // Blue
                        'rgba(156, 163, 175, 0.6)',
                        'rgba(156, 163, 175, 0.6)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: { display: true, text: 'Vulnerability / ASR (%)' }
                    }
                }
            }
        });

    </script>
</body>
</html>